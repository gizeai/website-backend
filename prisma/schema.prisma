generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum InvoiceStatus {
  PENDING
  PAID
  CANCELED
}

enum LoginMethod {
  GOOGLE
  MICROSOFT
  CREDENTIALS
}

enum SubuserPermission {
  ADMINISTRATOR
  USER
}

enum Plan {
  FLASH
  CREATOR
  INFLUENCER
  VIRAL
}

enum PostType {
  IMAGE
  VIDEO
  CARROUSEL
}

enum InvoiceAction {
  ENTERPRISE_CREATE
  ENTERPRISE_RENEW
  PLAN_UPGRADE
}

enum Recurrence {
  MONTHLY
  YEARLY
}

model User {
  id               String      @id @default(uuid())
  signUpId         String      @unique @map("sign_up_id")
  name             String
  email            String      @unique
  password         String
  loginMethod      LoginMethod @map("login_method")
  avatarUrl        String      @default("") @map("avatar_url")
  verificationCode String      @map("verification_code")

  enterprises Enterprise[]
  sessions    Session[]

  createdAt DateTime @default(now()) @map("created_at")
  updateAt  DateTime @updatedAt @map("update_at")
  lastLogin DateTime @default(now()) @map("last_login")

  @@unique([signUpId, email])
  @@map("users")
}

model Session {
  id        String   @id @default(uuid())
  token     String
  ipAddress String   @map("ip_address")
  expireAt  DateTime @map("expire_at")
  createdAt DateTime @default(now()) @map("created_at")
  signature String

  user   User   @relation(fields: [userId], references: [id])
  userId String @map("user_id")

  @@map("sessions")
}

model ReedemPassword {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  code      String
  expireAt  DateTime @map("expire_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("reedem_passwords")
}

model Enterprise {
  id String @id @default(uuid())

  user   User   @relation(fields: [userId], references: [id])
  userId String @map("user_id")

  name        String
  colors      String   @default("Roxo e azul")
  font        String   @default("inter")
  language    String   @default("pt")
  keywords    String[]
  active      Boolean  @default(false)
  infos       String   @db.Text
  personality String   @db.Text
  credits     Int
  plan        Plan
  metrics     String   @default("{}") @map("metrics") @db.Text //JSON STRING

  posts    Post[]
  logs     Log[]
  subusers Subuser[]

  createdAt         DateTime @default(now()) @map("created_at")
  updateAt          DateTime @updatedAt @map("update_at")
  expireAt          DateTime @map("expire_at")
  lastCreditsUpdate DateTime @map("last_credits_update")

  @@map("enterprises")
}

model Log {
  id       String @id @default(uuid())
  title    String
  userName String @map("user_name")
  userId   String @map("user_id")
  tag      String

  enterprise   Enterprise? @relation(fields: [enterpriseId], references: [id])
  enterpriseId String?

  createdAt DateTime @default(now()) @map("created_at")

  @@map("logs")
}

model Subuser {
  id         String            @id @default(uuid())
  userId     String            @map("user_id")
  email      String
  permission SubuserPermission

  enterprise   Enterprise @relation(fields: [enterpriseId], references: [id])
  enterpriseId String     @map("enterprise_id")
}

model Post {
  id String @id @default(uuid())

  enterprise   Enterprise @relation(fields: [enterpriseId], references: [id])
  enterpriseId String     @map("enterprise_id")

  title              String
  promptSent         String   @map("body_send")
  artModel           String   @map("art_model")
  type               PostType
  instructions       String   @default("{}") @db.Text //JSON STRING
  responseBody       String?  @map("response_body")
  responseAttachment String[] @map("response_attachment")

  iaModel     String @map("ia_model")
  edits       Int    @default(0) @map("edits")
  creditsUsed Int    @map("credits_used")

  createdAt DateTime @default(now()) @map("created_at")
  updateAt  DateTime @updatedAt @map("update_at")

  @@map("posts")
}

model Invoice {
  id             String        @id @default(uuid())
  publicId       Int           @unique @default(autoincrement())
  enterpriseId   String        @map("enterprise_id")
  enterpriseName String        @map("enterprise_name")
  status         InvoiceStatus
  action         InvoiceAction
  recurrence     Recurrence
  plan           Plan
  value          Float
  currency       String
  discount       Int           @default(0)

  paidAt     DateTime? @map("paid_at")
  paidWith   String?   @map("paid_with")
  paidValue  Float?    @map("paid_value")
  paidCoupon String?   @map("paid_coupon")
  paidBy     String?   @map("paid_by")

  paymentUrl       String?   @map("payment_url")
  paymentUrlExpire DateTime? @map("payment_url_expire")

  expireAt  DateTime @map("expire_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("invoices")
}

model InvoicePack {
  id       String   @id @default(uuid())
  invoices String[]

  createdAt DateTime @default(now()) @map("created_at")
  updateAt  DateTime @updatedAt @map("update_at")

  @@map("invoice_packs")
}

model Upload {
  id             String @id @default(uuid())
  fileName       String @map("file_name")
  userId         String @map("user_id")
  originalName   String @map("original_name")
  mimeType       String @map("mime_type")
  uses           Int    @default(0)
  size           Int
  storedLocation String @map("stored_location")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("uploads")
}
